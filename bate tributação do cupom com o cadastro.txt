SELECT ITCUPOM.CODPRODUTO, ITCUPOM.TPTRIBICMS, ITCUPOM.ALIQICMS, SUM(VALORTOTAL)
FROM ITCUPOM 
INNER JOIN PRODUTO USING (CODPRODUTO)
INNER JOIN CLASSFISCAL AS CF ON(CODCFPDV=CODCF)
WHERE IDCUPOM IN (
SELECT IDCUPOM from CUPOM WHERE CODESTABELEC=1 and CAIXA=1 and DTMOVTO='2016-05-10' order BY TOTALLIQUIDO DESC
)
AND ITCUPOM.TPTRIBICMS<>CF.TPTRIBICMS
and CF.ALIQREDICMS =0
GROUP BY 1,2,3
